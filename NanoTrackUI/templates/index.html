{% extends "base.html" %}
{% block content %}

<div class="card">
  <h2>Mode and Tracker</h2>
  <form method="post" enctype="multipart/form-data" class="grid">
    <div class="grid-3">
      <div>
        <label class="label">Mode</label>
        <select name="mode" id="mode" class="input" onchange="toggleSections()">
          <option value="upload" selected>Upload a video</option>
          <option value="camera">Camera (real-time)</option>
        </select>
      </div>
      <div>
        <label class="label">Tracker</label>
        <select name="tracker" id="tracker" class="input" onchange="toggleSections()">
          <option value="norfair">Norfair</option>
          <option value="bytetrack">ByteTrack</option>
        </select>
      </div>
      <div></div>
    </div>

    <h2>Model and Json Paths</h2>
    <div class="grid-2">
      <div>
        <label class="label">Engine (.engine)</label>
        <input class="input" type="text" name="engine_path" placeholder="{{ default_engine }}" />
        <small class="hint">Default: {{ default_engine }}</small>
      </div>
      <div>
        <label class="label">Meta JSON</label>
        <input class="input" type="text" name="meta_path" placeholder="{{ default_meta }}" />
        <small class="hint">Default: {{ default_meta }}</small>
      </div>
    </div>

    <h2>Detection / NMS Parameters</h2>
    <div class="grid-3">
      <div>
        <label class="label">conf_thres</label>
        <input class="input" type="number" name="conf_thres" step="0.01" min="0" max="1" value="{{ defaults.conf_thres }}">
      </div>
      <div>
        <label class="label">iou_thres</label>
        <input class="input" type="number" name="iou_thres" step="0.01" min="0" max="1" value="{{ defaults.iou_thres }}">
      </div>
      <div>
        <label class="label">nms_mode</label>
        <select class="input" name="nms_mode">
          <option value="agnostic" {% if defaults.nms_mode == 'agnostic' %}selected{% endif %}>agnostic</option>
          <option value="aware"    {% if defaults.nms_mode == 'aware' %}selected{% endif %}>aware</option>
        </select>
      </div>
    </div>

    <div id="btParams" class="card subtle">
      <h3>ByteTrack Parameters</h3>
      <div class="grid-4">
        <div>
          <label class="label">track_thresh</label>
          <input class="input" type="number" step="0.01" min="0" max="1" name="track_thres" value="{{ defaults.track_thres }}">
        </div>
        <div>
          <label class="label">match_thresh</label>
          <input class="input" type="number" step="0.01" min="0" max="1" name="match_thres" value="{{ defaults.match_thres }}">
        </div>
        <div>
          <label class="label">track_buffer (frames)</label>
          <input class="input" type="number" min="0" name="track_buffer" value="{{ defaults.track_buffer }}">
        </div>
        <div>
          <label class="label">min_box_area</label>
          <input class="input" type="number" step="0.1" min="0" name="min_box_area" value="{{ defaults.min_box_area }}">
        </div>
      </div>
      <small class="hint">Only for ByteTrack</small>
    </div>

    <div id="uploadSection">
      <h2>Upload a Video</h2>
      <input class="input" type="file" name="video_file" accept=".mp4,.mov,.avi,.mkv,.webm">
    </div>

    <div>
      <button class="btn" type="submit">İşle</button>
    </div>
  </form>
</div>

<script>
function toggleSections() {
  const tracker = document.getElementById('tracker').value;
  const mode    = document.getElementById('mode').value;
  document.getElementById('btParams').style.display = (tracker === 'bytetrack') ? 'block' : 'none';
  document.getElementById('uploadSection').style.display = (mode === 'upload') ? 'block' : 'none';
}
toggleSections();
</script>

{% endblock %}

